<!-- Toast & ConfirmDialog -->
<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<!-- Bouton Ajouter -->
<button pButton icon="pi pi-plus" class="p-button-success mb-3" aria-label="Ajouter un nouvel étudiant">
</button>

<!-- Table PrimeNG -->
<p-table #dt [value]="students" [paginator]="true" [rows]="5" [rowsPerPageOptions]="[5,10,20]" [loading]="loading">
    <!-- Caption + Recherche -->
    <ng-template pTemplate="caption">
        <div class="table-header">
            <span class="title"><i class="pi pi-users"></i> Liste des étudiants</span>
            <span class="p-input-icon-left">
                <i class="pi pi-search"></i>
                <input pInputText type="text" placeholder="Rechercher..."
                    (input)="dt.filterGlobal($any($event.target).value, 'contains')">
            </span>
        </div>
    </ng-template>

    <!-- Header -->
    <ng-template pTemplate="header">
        <tr>
            <th pSortableColumn="firstname">Prénom <p-sortIcon field="firstname"></p-sortIcon></th>
            <th pSortableColumn="lastname">Nom <p-sortIcon field="lastname"></p-sortIcon></th>
            <th pSortableColumn="email">Email <p-sortIcon field="email"></p-sortIcon></th>
            <th pSortableColumn="schoolId">Classe <p-sortIcon field="schoolId"></p-sortIcon></th>
            <th style="width: 120px; text-align:center;">Actions</th>
        </tr>
    </ng-template>

    <!-- Body -->
    <ng-template pTemplate="body" let-student>
        <tr>
            <td>{{ student.firstname }}</td>
            <td>{{ student.lastname }}</td>
            <td>{{ student.email }}</td>
            <td><span class="badge">{{ student.schoolId }}</span></td>
            <td class="actions">
                <button pButton icon="pi pi-pencil" class="p-button-rounded p-button-text p-button-info"
                    (click)="editStudent(student)" aria-label="Modifier">
                </button>
                <button pButton icon="pi pi-trash" class="p-button-rounded p-button-text p-button-danger"
                    aria-label="Supprimer">
                </button>
            </td>
        </tr>
    </ng-template>

    <!-- Empty Message -->
    <ng-template pTemplate="emptymessage">
        <tr>
            <td colspan="6" class="text-center">Aucun étudiant trouvé</td>
        </tr>
    </ng-template>
</p-table>

<!-- Dialog Add/Edit -->
<p-dialog [(visible)]="studentDialog" [modal]="true" [style]="{ width: '420px' }"
    [header]="isEdit ? 'Modifier étudiant' : 'Ajouter un étudiant'">

    <div class="p-fluid">
        <div class="field">
            <label>Prénom</label>
            <input pInputText [(ngModel)]="selectedStudent.firstname" required placeholder="Entrez le prénom" />
        </div>
        <div class="field">
            <label>Nom</label>
            <input pInputText [(ngModel)]="selectedStudent.lastname" required placeholder="Entrez le nom" />
        </div>
        <div class="field">
            <label>Email</label>
            <input pInputText type="email" [(ngModel)]="selectedStudent.email" required placeholder="Entrez l'email" />
        </div>
        <div class="field">
            <label>Classe</label>
            <input pInputText [(ngModel)]="selectedStudent.schoolId" required placeholder="Entrez la classe" />
        </div>
    </div>

    <ng-template pTemplate="footer">
        <button pButton icon="pi pi-times" class="p-button-text" (click)="studentDialog = false" aria-label="Annuler">
        </button>
        <button pButton icon="pi pi-check" class="p-button-primary" [disabled]="!isFormValid()"
            aria-label="Enregistrer">
        </button>
    </ng-template>
</p-dialog>